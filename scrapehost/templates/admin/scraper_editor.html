{% extends 'admin/layout.html' %}


{% block admin_content %}
    <form class='form' method='POST' id='scraper-editor'>
        <label for='scraper-name'>
            <p>Name</p>
            <input
            {% if scraper %}
                value='{{ scraper.name }}'
            {% endif %}
            type='text' class='input-text input-text-contrast' name='scraper-name'/>
        </label>
        <label for='scraper-location'>
            <p>Location / Website</p>
            <input
            {% if scraper %}
                value='{{ scraper.location }}'
            {% endif %}
            type='text' class='input-text input-text-contrast' name='scraper-location' placeholder='http://example.com/'/>
        </label>
        <label for='scraper-query'>
            <label for='scraper-query-presets'>
                <p>Query presets</p>
                <select name='scraper-query-preset' id='scraper-query-preset'>
                    <option value='undefined' data-code=''>- Select preset -</option>
                    {% for preset in presets %}
                        <option value='{{ preset.name }}' data-code='{{ preset.code }}'>{{ preset.name }}</option>
                    {% endfor %}
                </select>
            </label>
            <div class='push-down'>
                <p>Query <a title='how to write a scraper-query' href='/site-posts/scraper-query'>(?)</a></p>
                <textarea class='input-textarea' name='scraper-query' id='scraper-query'>{% if scraper %}{{ scraper.query }}{% endif %}</textarea>
                {% if scraper.error %}
                    <div class='push-down form-errors'>
                        <div class='form-errors-error'>{{ scraper.error }}</div>
                    </div>
                {% endif %}
            </div>
        </label>
        <label for='scraper-sleep_time'>
            <p>Sleep time (minutes)</p>
            <input
                {% if scraper %}
                    value='{{ scraper.sleep_time }}'
                {% endif %}
            class='input-text input-text-contrast' type='number' name='scraper-sleep_time'/>
        </label>
        <label>
            <p class='push-down'>Restrict to one domain</p>
            <input

            {% if scraper %} 
                {% if scraper.domain_restrict %}
                    checked
                {% endif %}
            {% else %}
                checked
            {% endif %}

            type="checkbox" name="scraper-domain_restrict" class="input-toggle" id='scraper-domain_restrict'>
            <label for="scraper-domain_restrict"></label>
        </label>
        <div class='split push-down' id='scraper-plan-selector'>
            {% for plan in plans %}
                <section>
                    <div class='card scraper-plan-card'
                    data-id='{{ loop.index - 1 }}'
                   {% if scraper %} {% if scraper.plan == loop.index - 1 %} data-selected='1' {% endif %} {% else %}
                   {% if loop.index == 2 %} data-selected='1' {% endif %} {% endif %}
                   >
                        <div class='card-body'>
                            <h4>{{ plan.name }}</h4>
                            <p>{{ plan.price }}$</p>
                        </div>
                    </div>
                </section>
            {% endfor %}
            <input
            {% if scraper %}
                value='{{ scraper.plan }}'
            {% else %}
                value='1'
            {% endif %}
            type='hidden' name='scraper-plan'>
        </div>
        <label>
            <p class='push-down'>Scraper status (On / Off)</p>
            <input

            {% if scraper %} 
                {% if scraper.status == 1 %}
                    checked
                {% endif %}
            {% else %}
                checked
            {% endif %}

            type="checkbox" name="scraper-status" class="input-toggle" id='scraper-status'>
            <label for="scraper-status"></label>
        </label>
        <div class='push-down'>
            <input type='submit' class='btn btn-primary' name='save' value='Save'/>
            <a href='/admin/scrapers/download/{{ scraper._id }}' target='_blank' class='btn btn-primary push-right'><i class='material-icons'>cloud_download</i>Download Data ({{ scraper.data | length }})</a>
            <input type='submit' class='btn btn-warning push-right' name='delete-data' value='Empty data'/>
            <input type='submit' class='btn btn-warning push-right' name='delete' value='Delete'/>
        </div>
        {% include 'components/errors.html' %}
    </form>
    {% if scraper.found_urls | length > 0 %}
        <div class='site-section'>
            <div class='text-content'>
                <table class='table'>
                    <thead>
                        <tr>
                            <th>URL Index</th>
                            <th>URL</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{{ scraper.url_index }}</td>
                            <td>{{ scraper.found_urls[scraper.url_index] }}</td>
                            <td>{{ scraper.data | length }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}
{% endblock %}
